name: Build and Release LoL Overlay

# ì–¸ì œ ì‹¤í–‰í• ì§€ ì„¤ì • (v1.0.0 ê°™ì€ íƒœê·¸ë¥¼ ë¶™ì—¬ì„œ í‘¸ì‹œí•˜ë©´ ì‹¤í–‰ë¨)
on:
  push:
    tags:
      - 'v*'

permissions:
  contents: write

jobs:
  build:
    runs-on: windows-latest

    steps:
      # 1. ë‚´ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
      - name: Checkout Code
        uses: actions/checkout@v4

      # ==================================================
      # ğŸ ë°±ì—”ë“œ ë¹Œë“œ (Python)
      # ==================================================
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10' # ê°œë°œ í™˜ê²½ê³¼ ë¹„ìŠ·í•œ ë²„ì „ ì‚¬ìš©
          architecture: 'x64'

      - name: Install Python Dependencies
        working-directory: ./backend
        run: |
          python -m pip install --upgrade pip
          pip install pyinstaller
          # requirements.txtê°€ ìˆë‹¤ë©´ ì„¤ì¹˜, ì—†ë‹¤ë©´ í•„ìš”í•œ íŒ¨í‚¤ì§€ ì§ì ‘ ì„¤ì¹˜
          # (ì‚¬ìš©ìë‹˜ í™˜ê²½ì— ë§ì¶° í•„ìš”í•œ íŒ¨í‚¤ì§€ë“¤ì„ ë‚˜ì—´í–ˆìŠµë‹ˆë‹¤)
          pip install flask flask-cors lcu-driver pywin32 mss opencv-python pytesseract requests numpy

      - name: Build Backend (PyInstaller)
        working-directory: ./backend
        # ì‚¬ìš©ìë‹˜ì´ ì„±ê³µí–ˆë˜ ê·¸ ëª…ë ¹ì–´ ê·¸ëŒ€ë¡œ ì‚¬ìš© (+ Tesseract ê²½ë¡œ ì£¼ì˜)
        # ì£¼ì˜: GitHub ì €ì¥ì†Œì— 'backend/Tesseract-OCR' í´ë”ê°€ ì˜¬ë¼ê°€ ìˆì–´ì•¼ í•©ë‹ˆë‹¤!
        run: |
          pyinstaller --noconfirm --onedir --console --name "lol_api" --exclude-module pandas --add-data "augments_global_ko.json;." --add-data "augment_mapping_full.txt;." --add-data "game_data.db;." --add-data "Tesseract-OCR;Tesseract-OCR" app.py

      # ==================================================
      # âš›ï¸ í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ (Node.js + Electron)
      # ==================================================
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: Install Frontend Dependencies
        working-directory: ./frontend
        run: npm install

      - name: Build Frontend & Package (Electron Builder)
        working-directory: ./frontend
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: npm run dist

      # ==================================================
      # ğŸš€ ë¦´ë¦¬ì¦ˆ ì—…ë¡œë“œ (GitHub Releasesì— íŒŒì¼ ì˜¬ë¦¬ê¸°)
      # ==================================================
      - name: Release to GitHub
        uses: softprops/action-gh-release@v1
        if: startsWith(github.ref, 'refs/tags/')
        with:
          files: |
            frontend/dist/*.exe